# Crypto Specification

This document serves as a high level design document for the block cipher functions of dcrypt.

# Definitions
- `SALT` initialization vector generated with `random_bytes`.
- `COST` integer which will ultimately be passed as cost parameter to `PBKDF2`.
- `CIPHER` the chosen cipher method as a string
- `ALGO` the chosen hmac algorithm as a string
- `PBKDF2` is the password-based key derivation function supported by PHP (hash_pbkdf2). The parameters are:
    - `ALGO`
    - `PASSWORD` + `CIPHER`
    - `SALT`
    - `COST` number of iterations
- `HKDF` is the password-based key derivation function supported by PHP (hash_hkdf). The parameters are:
    - `ALGO`
    - derived key generated by `PBKDF2`
    - info string parameter
- `HMAC` is a HMAC checksum function supported by PHP (hash_hmac). The parameters are:
    - `ALGO`
    - input data to hash
    - `AKEY`
- `ENCRINFO` is the string `encryptionKey`
- `AUTHINFO` is the string `authenticationKey`
- `MTEXT` the plaintext message to be encrypted

# Steps for encryption
1. Obtain a new `SALT` of appropriate size for given `CIPHER`
1. Derive a new key `PKEY` from `PASSWORD` using `PBKDF2()`
1. Derive authentication key `AKEY` = `HKDF` with info parameter = `AUTHINFO`
1. Derive encryption key `EKEY` = `HKDF` with info parameter = `ENCRINFO`
1. Use `OPENSSL` to get the raw encrypted string `CTEXT`
1. Generate a checksum for the ciphertext with `HMAC`
1. Concatenate the following values
    1. `SALT`
    1. `CHECKSUM`
    1. `TAG` (if required by `CIPHER`, otherwise ignore)
    1. `CTEXT`
    
# Steps for decryption
